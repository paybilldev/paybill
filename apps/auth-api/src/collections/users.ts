import {defineCollection} from '@paybilldev/sequelize';

export default defineCollection({
  dumpRules: {group: 'auth'},
  migrationRules: ['schema-only', 'overwrite'],
  name: 'users',
  title: 'Users',
  comment: 'Auth: Stores user login data within a secure schema.',
  model: 'UserModel',
  createdBy: false,
  updatedBy: false,
  createdAt: true,
  updatedAt: true,
  deletedAt: true,
  logging: true,
  shared: false,
  fields: [
    {
      name: 'instance_id',
      type: 'uuid',
      interface: 'input',
      comment: 'ID of the instance/environment this user belongs to.',
      uiSchema: {type: 'string', title: 'Instance ID', 'x-component': 'Input'},
    },
    {
      name: 'id',
      type: 'uuid',
      primaryKey: true,
      allowNull: false,
      interface: 'id',
      comment: 'Primary key: unique identifier for the user.',
      uiSchema: {
        type: 'string',
        title: 'User ID',
        'x-component': 'Input',
        'x-read-pretty': true,
      },
    },
    {
      name: 'aud',
      type: 'string',
      interface: 'input',
      comment: 'Audience of the user, e.g., client or tenant scope.',
      uiSchema: {type: 'string', title: 'Audience', 'x-component': 'Input'},
    },
    {
      name: 'role',
      type: 'string',
      interface: 'input',
      comment: 'Role of the user, e.g., admin, user, or custom role.',
      uiSchema: {type: 'string', title: 'Role', 'x-component': 'Input'},
    },
    {
      name: 'email',
      type: 'string',
      interface: 'input',
      unique: true,
      comment: 'Primary email address of the user (must be unique).',
      uiSchema: {
        type: 'string',
        title: 'Email',
        'x-component': 'Input',
        'x-validator': 'email',
      },
    },
    {
      name: 'encrypted_password',
      type: 'string',
      hidden: true,
      interface: 'password',
      comment: 'Hashed password for authentication (stored securely).',
      uiSchema: {
        type: 'string',
        title: 'Encrypted Password',
        'x-component': 'Password',
      },
    },
    {
      name: 'email_confirmed_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the user confirmed their email.',
      uiSchema: {
        type: 'datetime',
        title: 'Email Confirmed At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'invited_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the user was invited to the system.',
      uiSchema: {
        type: 'datetime',
        title: 'Invited At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'confirmation_token',
      type: 'string',
      interface: 'input',
      unique: true,
      comment: 'Token sent to user to confirm their email.',
      uiSchema: {
        type: 'string',
        title: 'Confirmation Token',
        'x-component': 'Input',
      },
    },
    {
      name: 'confirmation_sent_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the confirmation token was sent.',
      uiSchema: {
        type: 'datetime',
        title: 'Confirmation Sent At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'recovery_token',
      type: 'string',
      interface: 'input',
      unique: true,
      comment: 'Token used for account recovery (e.g., password reset).',
      uiSchema: {
        type: 'string',
        title: 'Recovery Token',
        'x-component': 'Input',
      },
    },
    {
      name: 'recovery_sent_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the recovery token was sent.',
      uiSchema: {
        type: 'datetime',
        title: 'Recovery Sent At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'email_change_token_new',
      type: 'string',
      interface: 'input',
      unique: true,
      comment:
        'Token sent to confirm a new email address during change process.',
      uiSchema: {
        type: 'string',
        title: 'Email Change Token New',
        'x-component': 'Input',
      },
    },
    {
      name: 'email_change',
      type: 'string',
      interface: 'input',
      comment: 'Temporary storage for a new email during change process.',
      uiSchema: {type: 'string', title: 'Email Change', 'x-component': 'Input'},
    },
    {
      name: 'email_change_sent_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when email change token was sent.',
      uiSchema: {
        type: 'datetime',
        title: 'Email Change Sent At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'last_sign_in_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp of the last user sign-in.',
      uiSchema: {
        type: 'datetime',
        title: 'Last Sign In',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'app_metadata',
      type: 'jsonb',
      comment: 'Metadata stored by the app (custom user properties).',
    },
    {
      name: 'user_metadata',
      type: 'jsonb',
      comment: 'Metadata stored per user (custom user-specific properties).',
    },
    {
      name: 'is_super_admin',
      type: 'boolean',
      defaultValue: false,
      interface: 'checkbox',
      comment: 'Flag to indicate if user has super admin privileges.',
      uiSchema: {
        type: 'boolean',
        title: 'Super Admin',
        'x-component': 'Switch',
      },
    },
    {
      name: 'phone',
      type: 'string',
      unique: true,
      interface: 'input',
      comment: 'Primary phone number of the user (must be unique).',
      uiSchema: {type: 'string', title: 'Phone', 'x-component': 'Input'},
    },
    {
      name: 'phone_confirmed_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the user confirmed their phone number.',
      uiSchema: {
        type: 'datetime',
        title: 'Phone Confirmed At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'phone_change',
      type: 'string',
      interface: 'input',
      comment: 'Temporary storage for new phone number during change process.',
      uiSchema: {type: 'string', title: 'Phone Change', 'x-component': 'Input'},
    },
    {
      name: 'phone_change_token',
      type: 'string',
      interface: 'input',
      comment: 'Token used to confirm phone number changes.',
      uiSchema: {
        type: 'string',
        title: 'Phone Change Token',
        'x-component': 'Input',
      },
    },
    {
      name: 'phone_change_sent_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when phone change token was sent.',
      uiSchema: {
        type: 'datetime',
        title: 'Phone Change Sent At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'confirmed_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Computed timestamp: earliest of email or phone confirmation.',
      uiSchema: {
        type: 'datetime',
        title: 'Confirmed At (computed)',
        description: 'Computed as earliest of email or phone confirmation.',
        'x-component': 'DatePicker',
        'x-read-pretty': true,
      },
    },
    {
      name: 'email_change_token_current',
      type: 'string',
      interface: 'input',
      unique: true,
      comment: 'Token used to confirm current email during change process.',
      uiSchema: {
        type: 'string',
        title: 'Email Change Token Current',
        'x-component': 'Input',
      },
    },
    {
      name: 'email_change_confirm_status',
      type: 'integer',
      defaultValue: 0,
      interface: 'number',
      comment:
        'Status of email change confirmation: 0 = not confirmed, 1 = new email confirmed, 2 = old email confirmed.',
      uiSchema: {
        type: 'number',
        title: 'Email Change Confirm Status',
        description:
          '0 = not confirmed, 1 = new email confirmed, 2 = old email confirmed',
        'x-component': 'Input',
      },
    },
    {
      name: 'banned_until',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp until which the user is banned from signing in.',
      uiSchema: {
        type: 'datetime',
        title: 'Banned Until',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'reauthentication_token',
      type: 'string',
      interface: 'input',
      unique: true,
      comment: 'Token used to reauthenticate the user for sensitive actions.',
      uiSchema: {
        type: 'string',
        title: 'Reauthentication Token',
        'x-component': 'Input',
      },
    },
    {
      name: 'reauthentication_sent_at',
      type: 'datetimeTz',
      interface: 'datepicker',
      comment: 'Timestamp when the reauthentication token was sent.',
      uiSchema: {
        type: 'datetime',
        title: 'Reauthentication Sent At',
        'x-component': 'DatePicker',
      },
    },
    {
      name: 'is_sso_user',
      type: 'boolean',
      defaultValue: false,
      interface: 'checkbox',
      comment:
        'Flag indicating the account comes from SSO. SSO users may have duplicate emails.',
      uiSchema: {
        type: 'boolean',
        title: 'SSO User',
        description:
          'Set true when account comes from SSO. These accounts can have duplicate emails.',
        'x-component': 'Switch',
      },
    },
    {
      name: 'is_anonymous',
      type: 'boolean',
      defaultValue: false,
      interface: 'checkbox',
      comment:
        'Flag indicating if the account is anonymous (not linked to a real user).',
      uiSchema: {type: 'boolean', title: 'Anonymous', 'x-component': 'Switch'},
    },
  ],
});
